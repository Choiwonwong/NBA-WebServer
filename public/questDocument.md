# Quest 서비스란?

Quest 서비스는 EKS 프로비저닝과 미리 준비해주신 이미지를 쉽고 빠르게 배포하기 위해서 사용할 수 있는 통합 서비스입니다.

EKS를 프로비저닝하는 작업부터 해당 EKS에 만들어두신 애플리케이션을 배포하고, 엔드포인트를 통해 확인하실 수 있어요.

##### 이러한 일련의 과정을 _빠르고(Quick)_, _통합하여(United)_, _쉽고(Easy)_, _간단하게(Simple)_ 만들어주는 도구(Tool)가 저희 Quest 서비스에요.

아직은 제약 사항이 많으니, 아래의 _Quest Service 제약 사항_ 을 꼭 확인해주세요.

Quest 서비스는 *Quest.yaml*을 통해 이루어져요.

또한, Quest.yaml을 작성하기 위한 방법을 "최소", "전체", "배포" 라는 3가지로 구분해서 설명했어요. 필요하신 사항을 가지고 가셔서 예제를 가져가셔서 사용하세요.

---

## Quest Service 제약 사항 및 범위

이는 현재 서비스의 범위와 동일한 의미를 가져요. 이를 *프로비저닝*과 *배포*의 측면에서 설명드릴게요.

### Provisioning

현재는 _EKS 프로비저닝_ 만 지원해요.

요청하신 EKS를 확실하게 프로비저닝할 수 있게, 네트워크 요소들은 새로 올라갈 수 있다는 점 양해 부탁드려요.

데이터 플레인 타입은 _노드그룹_ 만 가능해요.

### Deploy

현재는 하나의 요청에 애플리케이션만 배포가 가능해요.

만약, EKS위에 추가적인 배포를 원하시면, "요청 타입: 배포" 형태로 서비스를 한번 더 이용하셔야해요.

또한, 서비스 노출 방식은 LoadBalancer 타입으로만 가능해요.

사용자께서 배포하신 애플리케이션을 확인하시기 위해 가장 빠르고 확실한 방법이에요.

이를 L7 Ingress를 적용하기 위해선, 직접 구성을 해야 해요.

다행히, 저희 서비스를 통해 배포를 진행하시면 해당 EKS 환경에 AWS LoadBalancer Controller가 배포되니깐, 별도의 Ingress Controller를 구성하실 필요는 없어요.

### AWS Credentials

저희 서비스를 사용하시면 사용자의 AWS 계정에 EKS 환경이 프로비저닝 돼요.

이를 위해서 AWS 계정의 토큰을 필요해요.

이때, 정상적인 프로비저닝을 위해서 루트 계정의 토큰을 입력하셔야해요.

이 점을 주의해주시고, 입력해주신 Credentials은 절대 외부로 노출되지 않아요.

### 인증 과정

현재 Quest 서비스는 로그인 과정이 없어요. 그렇기 때문에 데모 버전이라고 봐주시고, 이러한 서비스의 효과의 측면을 봐주시면 될 것 같아요.

로그인 및 인증 기능은 프로젝트 이후에 추가할 예정이에요.

---

## Quest.yaml 작성 방법

저희 서비스를 사용하기 위해선 Quest.yaml에 아래에 정의된 규칙대로 작성하신 후 서비스를 이용하실 수 있어요.

현재는 "전체 입력" 부분에서 정의된 내용들만 사용하실 수 있으니깐, 양해 부탁드려요.

Quest.yaml에 포함된 \_(아랫 하이픈)은 작성하실 때 제외하셔도 문제 없어요. :)

> 예를 들어 요청\_명을 요청명으로 입력하셔도 문제 없이 동작해요.

또한, 각 Block의 순서는 상관이 없어요. 다만 .yaml 형식은 지켜주셔야해요

명 혹은 이름에 지정하시는 이름은 요청\_명을 제외하면 모두 영어 소문자를 사용해주셔야해요.

만약, 이 부분이 지켜지지 않으면 서비스가 정상적으로 동작하지 않을 수 있어요.

### 최소 입력

위 사항은 무조건 입력하셔야하는 값들이에요. 해당 값들이 입력되지 않으면, 서비스를 사용하실 수 없어요.

```yaml
요청_명: example
AWS_인증정보:
  AWS_계정_접근_키: "Access Key"
  AWS_계정_비밀_키: "Secret Key"
배포_요청:
  애플리케이션:
    이미지_이름: example:latest
    포트_번호: 80
```

이렇게 입력하시고 서비스를 이용하시면 나머지 값들은 모두 기본 값으로 사용되요. 해당 요청을 수행하시면 아래와 같이 프로비저닝되고, 배포가 수행된다는 점을 확인하실 수 있어요.

```yaml
요청_명: example
요청_타입: 전체
AWS_지역_명: 도쿄
네트워크_환경:
  개인_작업_네트워크_이름(VPC): quest-vpc
  인터넷_가능_블럭_네트워크(Public_Subnet): 2개
  인터넷_불가능_블럭_네트워크(Private_Subnet): 2개
  인터넷_게이트웨이(IGW): 1개
  인터넷주소_변환_게이트웨이(NAT_GW): 1개
컴퓨팅_요청:
  컨트롤_플레인(EKS):
    이름: quest-eks
    버전: "1.27"
  데이터_플레인:
    이름: quest-data-plane
    기반: "[변경 불가]-가상머신"
    과금방식: "[변경 불가]-SPOT"
    스펙: 중(t3.medium)
    가상머신_개수:
      최대: 4개
      최소: 2개
      요구: 3개
배포_요청:
  네임_스페이스_이름: default
  애플리케이션:
    이름: quest-app
    이미지_이름: example:latest
    포트_번호: "80"
    복제본_개수: "3"
  서비스:
    이름: quest-service
    서비스_타입: "[변경 불가]-로드밸런서"
```

생성되는 기본값을 여기에서 확인하실 수 있어요.

### 전체 요청

입력하실 수 있는 전체 Quest.yaml 양식은 아래와 같아요

```yaml
요청_명: example
요청_타입: 전체 or 배포 # 기본값: 전체
AWS_인증정보:
  AWS_계정_접근_키: "Access Key"
  AWS_계정_비밀_키: "Secret Key"
  AWS_지역_명: 도쿄 or 서울 # 기본값: 도쿄
네트워크_환경:
  개인_작업_네트워크_이름: example # 1개
  인터넷_가능_블럭_네트워크: 2 # 기본: 2개
  인터넷_불가능_블럭_네트워크: 2 # 기본: 2개
컴퓨팅_요청:
  컨트롤_플레인:
    이름: example # 기본 값: quest-eks
    버전: 1.27 # 기본값: 1.27
  데이터_플레인:
    이름: example ## 기본값: quest-dataplane
    스펙: 중 or 대 # 중(t3.medium) or 대(t3.large) - 기본값: 중
    가상머신_개수:
      최대: 2 # 기본값: 4
      최소: 1 # 기본값: 2
      요구: 2 # 기본값: 3
배포_요청:
  네임스페이스이름: example # 기본값: default
  애플리케이션:
    이름: example # 기본값: quest-app
    이미지_이름: nginx:latest
    포트_번호: 80
    복제본_개수: 3 # 기본값: 3
  서비스:
    이름: example # 기본값: quest-service
  환경_변수: # 추가 변수
    - 이름: exmple-key
      값: example-value
```

이를 입력하시면 아래와 같은 확인 결과를 보실 수 있어요

```yaml
요청_명: example
요청_타입: 전체
AWS_지역_명: 도쿄
네트워크_환경:
  개인_작업_네트워크_이름(VPC): example
  인터넷_가능_블럭_네트워크(Public_Subnet): 2개
  인터넷_불가능_블럭_네트워크(Private_Subnet): 2개
  인터넷_게이트웨이(IGW): 1개
  인터넷주소_변환_게이트웨이(NAT_GW): 1개
컴퓨팅_요청:
  컨트롤_플레인(EKS):
    이름: example
    버전: "1.27"
  데이터_플레인:
    이름: example
    기반: "[변경 불가]-가상머신"
    과금방식: "[변경 불가]-SPOT"
    스펙: 중(t3.medium)
    가상머신_개수:
      최대: 2개
      최소: 1개
      요구: 2개
배포_요청:
  네임_스페이스_이름: example
  애플리케이션:
    이름: quest-app
    이미지_이름: nginx:latest
    포트_번호: "80"
    복제본_개수: "3"
  서비스:
    이름: quest-service
    서비스_타입: "[변경 불가]-로드밸런서"
  환경_변수:
    - 환경_변수_명: exmple-key
      환경_변수_값: example-value
```

---

### 배포 요청

이는 기존에 존재하는 EKS를 지정하시고, 배포만 요청하시는 경우 사용하실 수 있어요.

만약, 아래에 포함된 요소들이 정확하지 않다면, 정상적으로 배포가 이루어지지 않을 수 있어요

지켜주셔야할 부분은, 컴퓨팅 환경만 제대로 정의하시면 돼요

```yaml
요청_명: example
요청_타입: 배포 # 기본값: 전체
AWS_인증정보:
  AWS_계정_접근_키: "Access Key"
  AWS_계정_비밀_키: "Secret Key"
  AWS_지역_명: 도쿄 or 서울 # 기본값: 도쿄
컴퓨팅_요청:
  컨트롤_플레인:
    이름: example # 기본 값: quest-eks
  데이터_플레인:
    이름: example ## 기본값: quest-dataplane
배포_요청:
  네임스페이스이름: example # 기본값: default
  애플리케이션:
    이름: example # 기본값: quest-app
    이미지_이름: nginx:latest
    포트_번호: 80
    복제본_개수: 3 # 기본값: 3
  서비스:
    이름: example # 기본값: quest-service
  환경_변수: # 추가 변수
    - 이름: exmple-key
      값: example-value
```

나머지 부분은 동일해요.

이를 입력하시면 아래의 환경에서 배포가 진행돼요.

이 요청이 정상적으로 동작하기 위해선, 꼭 컨트롤 플레인의 이름이 정확해야해요.

만약, 컨트롤 플레인의 이름이 정확하지 않다면, 배포가 이루어지지 않아요.

데이터 플레인의 이름은 자세한 정보를 확인하시고 싶으실 경우 입력해주세요

```yaml
요청_명: example
요청_타입: 배포
AWS_지역_명: 도쿄
기존_컴퓨팅_환경:
  컨트롤_플레인: example
  데이터_플레인: example
배포_요청:
  네임_스페이스_이름: example
  애플리케이션:
    이름: quest-app
    이미지_이름: nginx:latest
    포트_번호: "80"
    복제본_개수: "3"
  서비스:
    이름: quest-service
    서비스_타입: "[변경 불가]-로드밸런서"
  환경_변수:
    - 환경_변수_명: exmple-key
      환경_변수_값: example-value
```

아래의 Quest.yaml 주의사항을 확인하시고 저희 서비스를 사용해주세요.

---

# Quest.yaml 주의사항

이는 Quest.yaml을 작성하실 때 주의해야할 요소들이에요.

아래 요소들의 값이 지정된 값을 벗어나면, 서비스가 기본값 혹은 정상적으로 동작하지 않을 가능성이 있어요.

- 요청\_명: 전체 or 배포
- AWS\_인증정보 > AWS\_지역\_명: 도쿄 or 서울
- 컴퓨팅\_요청 > 데이터\_플레인 > 스펙: 중 or 대

나머지 요소들에서 숫자로 입력해야할 부분을 지켜주시고, 요청\_명을 제외한 모든 이름 부분은 영어 소문자로 작성해주셔야해요.
